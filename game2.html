<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joseph's Pro Platformer</title>
    
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            /* --- MODIFICATION START --- */
            background-image: url('Joseph4.png'); /* Set image as background */
            background-size: cover; /* Ensure it covers the whole screen */
            background-position: center; /* Center the background image */
            background-repeat: no-repeat; /* Prevent tiling */
            /* Removed background-color: #1a1a2e; to see the image */
            /* --- MODIFICATION END --- */
            font-family: 'Arial', sans-serif;
        }
        #gameCanvas {
            border: 6px solid #4CAF50; /* Green border */
            background-color: #2e3b4e; /* Dark slate canvas background */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- Game Constants and Variables ---
        const GRAVITY = 1.0;          // Adjusted for better feel
        const JUMP_STRENGTH = -18;    // Stronger jump
        const MOVE_SPEED = 6;         // Faster movement
        const DRAG = 0.9;             // Horizontal deceleration (for smoother feel)

        let keys = {};
        let gameStarted = false;
        let gameWon = false;

        // --- Player Object ---
        let player = {
            x: 50,
            y: 50,
            width: 40,
            height: 40,
            velocityX: 0,
            velocityY: 0,
            isOnGround: false,
            image: new Image(),
        };
        player.image.src = 'Joseph4.png';
        const startX = player.x;
        const startY = player.y;

        // --- Level Design ---
        const platforms = [
            // Ground
            { x: 0, y: canvas.height - 20, width: canvas.width, height: 20, color: '#27ae60' }, 
            // Step 1
            { x: 150, y: canvas.height - 100, width: 100, height: 20, color: '#e67e22' },
            // Gap Platform 
            { x: 300, y: canvas.height - 200, width: 150, height: 20, color: '#c0392b' },
            // Wall / Tall Block
            { x: 550, y: canvas.height - 300, width: 50, height: 280, color: '#7f8c8d' },
            // Top Platform
            { x: 600, y: canvas.height - 300, width: 150, height: 20, color: '#3498db' }
        ];

        // --- Goal Definition (Win Block) ---
        const goal = { 
            x: 650, 
            y: canvas.height - 340, 
            width: 50, 
            height: 40, 
            color: '#f1c40f' 
        };

        // --- Input Handling ---
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (!gameStarted && player.image.complete) {
                gameStarted = true;
                gameLoop();
            }
            // Reset game on 'R' press after winning or falling
            if ((e.key === 'r' || e.key === 'R') && (gameWon || player.y > canvas.height)) {
                resetGame();
            }
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // --- Game Reset Function ---
        function resetGame() {
            player.x = startX;
            player.y = startY;
            player.velocityX = 0;
            player.velocityY = 0;
            gameWon = false;
            gameStarted = true;
        }

        // --- Collision Detection Function (AABB) ---
        function checkCollision(rectA, rectB) {
            return rectA.x < rectB.x + rectB.width &&
                   rectA.x + rectA.width > rectB.x &&
                   rectA.y < rectB.y + rectB.height &&
                   rectA.y + rectA.height > rectB.y;
        }

        // --- Update Function (Physics, Movement, Win Condition) ---
        function update() {
            if (gameWon) return; // Stop updates if the game is won

            // Horizontal Input
            if (keys['ArrowLeft'] || keys['a']) {
                player.velocityX = -MOVE_SPEED;
            } else if (keys['ArrowRight'] || keys['d']) {
                player.velocityX = MOVE_SPEED;
            } else {
                // Apply drag for smoother stopping
                player.velocityX *= DRAG;
            }
            
            // Jumping
            if ((keys[' '] || keys['ArrowUp'] || keys['w']) && player.isOnGround) {
                player.velocityY = JUMP_STRENGTH;
                player.isOnGround = false;
            }

            // Apply Gravity
            player.velocityY += GRAVITY;

            // Apply velocities to position
            player.x += player.velocityX;
            player.y += player.velocityY;

            // --- Collision Resolution (Platforms) ---
            player.isOnGround = false;
            
            platforms.forEach(platform => {
                const platformRect = { x: platform.x, y: platform.y, width: platform.width, height: platform.height };
                const playerRect = { x: player.x, y: player.y, width: player.width, height: player.height };
                
                if (checkCollision(playerRect, platformRect)) {
                    // Check collision from above (landing)
                    if (player.velocityY > 0 && playerRect.y + playerRect.height - player.velocityY <= platformRect.y) {
                        player.y = platformRect.y - player.height;
                        player.velocityY = 0;
                        player.isOnGround = true;
                    } 
                    // Check collision from below (hitting ceiling)
                    else if (player.velocityY < 0 && playerRect.y - player.velocityY >= platformRect.y + platformRect.height) {
                        player.y = platformRect.y + platformRect.height;
                        player.velocityY = 0;
                    }
                    // Horizontal Collision
                    else if (player.velocityX > 0 && playerRect.x + playerRect.width - player.velocityX <= platformRect.x) {
                        player.x = platformRect.x - player.width;
                        player.velocityX = 0;
                    } 
                    else if (player.velocityX < 0 && playerRect.x - player.velocityX >= platformRect.x + platformRect.width) {
                        player.x = platformRect.x + platformRect.width;
                        player.velocityX = 0;
                    }
                }
            });

            // --- Win Condition Check ---
            if (checkCollision(player, goal)) {
                gameWon = true;
            }

            // Simple Fall Check (Off the bottom of the screen)
            if (player.y > canvas.height) {
                gameStarted = false; // Requires 'R' to restart
            }
        }

        // --- Draw Function ---
        function draw() {
            // 1. Clear the canvas
            ctx.fillStyle = '#2e3b4e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw Platforms
            platforms.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.width, p.height);
            });
            
            // 3. Draw Goal
            ctx.fillStyle = goal.color;
            ctx.fillRect(goal.x, goal.y, goal.width, goal.height);

            // 4. Draw Player (your photo)
            if (player.image.complete) {
                ctx.drawImage(
                    player.image, 
                    player.x, 
                    player.y, 
                    player.width, 
                    player.height
                );
            } else {
                ctx.fillStyle = 'white';
                ctx.fillRect(player.x, player.y, player.width, player.height);
            }
            
            // 5. Draw Game State Text
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';

            if (gameWon) {
                ctx.font = '48px Arial';
                ctx.fillStyle = '#f1c40f'; // Gold text
                ctx.fillText("✨ LEVEL COMPLETE! ✨", canvas.width / 2, canvas.height / 2);
                ctx.font = '24px Arial';
                ctx.fillText("Press R to Replay", canvas.width / 2, canvas.height / 2 + 50);
            } else if (!gameStarted) {
                ctx.fillText("Game Over! Press R to Restart.", canvas.width / 2, canvas.height / 2);
                ctx.font = '18px Arial';
                ctx.fillText("WASD/Arrows to Move, Space/W to Jump.", canvas.width / 2, canvas.height / 2 + 40);
            } else {
                 ctx.font = '18px Arial';
                 ctx.fillText("Reach the Yellow Block!", canvas.width / 2, 30);
            }
        }

        // --- Main Game Loop ---
        function gameLoop() {
            update();
            draw();
            // Loop tied to the browser's refresh rate
            requestAnimationFrame(gameLoop);
        }

        // Start the initial loop to draw the start screen
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>